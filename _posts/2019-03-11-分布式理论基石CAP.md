---
layout: post
title:  "分布式理论基石CAP"
date:   2019-03-11 9:41:01 +0800
categories: 杂谈
tag: 分布式
---

* content
{:toc}

在进行一些分布式系统的组件的选型的时候，我们常常需要关注的一个点是这个组件是AP的还是CP的。那么CAP到底是什么呢？

## CAP是什么
顾名思义，我们先翻译一下CAP的意思
- C:Consistent 一致性
- A:Available 可用性
- P:Partition tolerance 分区容错性

1998年，加州大学的计算机科学家 Eric Brewer 提出，分布式系统有上述三个指标，并且系统无法同时做到CAP.
大白话就是你想要 系统做到一致性 ，可用性，和分区容错性是不可能的，你必须抛弃其中一个。
我们的系统现在一般都是分布式的，就是都是分区容错的。那么，我们只能在 A 和 C之间进行选择。
### Consistent 一致性
一致性是什么呢，简单来说，就是在分布式系统中，写入一个V值后，系统内的读操作都返回V值。
#### 最终一致性
如果写入一个V值,K值,S值，在一段时间内读操作并不是正确的返回V,K,S值，但是在固定的一段时间后，能返回最终的S值,这种情况就叫最终一致性。就是最后的结果是正确的
也可以简单的理解为在一段时间后，节点间的数据会最终达到一致状态
### Available 可用性
可用性是指，只要收到用户的请求，系统必须给出响应。
### Partition tolerance 分区容错性
分区容错性是指，系统中的节点可能因为网络原因无法和其他集群节点通信，这时候系统还是不受影响的。

### 为什么我们只能在AC之间进行选择
因为分布式系统中，会出现网络无法通信的情况。
如果要保证一致性，那么就要在写入V值的时候，锁住当前写服务，打开往其他节点的链接，然后写入其他节点这个值。这时候系统服务是不可用的。
如果要保证可用性，那么就不能在写入的时候，通知其他节点。那么这时候不是节点不是一致的。

## CAP如何指导我们的系统设计工作
dubbo的注册中心是dubbo，大家都知道。zk真的合适做注册中心么？
zk的本质上是一个共识达成解决者。他解决在分布式环境下的同步协调问题（保证写入zk的数据在分布式环境下一致）。他是CP类型的。选择zk做服务发现可以是可以。但是有一个问题，
就是zk的集群是如果宕机超过了一半，那么就会导致zk的服务不可用。这对于服务发现来说，是致命的。

所以，在我们的系统设计的时候，应该仔细根据业务去考虑 我们需要 C还是A. 然后选择对应的 CP还是CA的中间件。